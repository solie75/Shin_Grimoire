[Ref](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

![Identity_Center_User](/Image/Server/AWS_IdentityCenterUsers.png)

Recommended by AWS
- Allows us to manage multiple AWS accounts centrally
- Perfectly valid to have an Organization with a single user.

1. [what is IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html)
Identity and Access Management (IAM) 는 각 계정의 로그인과 권한 설정을 관리하는 시스템이다. 각 게정이 AWS Resource(서버, 데이터베이트 등) 에 접근할 수 있는 정도를 제어한다.
- 루트 사용자 주의
	- Root User 계정은 모든 권한을 가지므로 일상적인 작업에 사용하는 것은 위험하다. IAM 을 통해 관리자, 개발자 등 역할에 맞는 사용자 (Identity) 를 따로 만들고, 필요한 최소한의 권한 만 부여하여 사용해야 한다.
- 최종적 일관성 (Eventual Consistency)
	- IAM 데이터는 전 세계 데이터 센터에 복제되므로 변경 사항이전파되는 데 시간이 걸린다. 따라서 애플리케이션의 핵심 경로 에 IAM 변경 코드를 넣지 말고, 별도의 초기화 단계에서 처리 후 전파 확인을 거쳐야 한다.
- 비용
	- IAM, Identity Center, STS 기능 자체는 무료이며, 이를 통해 접근한 실제 AWS 리소스 (EC2, S3 등) 사용료만 청구된다.

[IAM Access Analyzer pricing](https://aws.amazon.com/ko/iam/access-analyzer/pricing/)
[Amazon Web Services pricing page](https://aws.amazon.com/ko/pricing/)

2. [What is IAM Identity Center](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

IAM Identity Center (구 AWS SSO) 는 여러 AWS 계정과 애플리케이션에 대한 접근을 단일 자격 증명(Single set of credentials) 으로 통합 관리하는 솔루션이다.
- 기존 AIm 과의 차이
	- 기존 Aim 사용자는 계정마다 별도의 ID/PW 가 필요했지만, Identity Center 사용자는 한번의 로그인 (SSO) 으로 권한이 있는 모든 계정과 앱에 접근할 수 있다.
- 관리의 편의정
	- 외부 자격 증명 공급자 (Google, MS 등)와 연동하여 사용자를 동기화하거나, 내부 디렉터리에서 직접 사용자를 생성 및 관리할 수 있다.
- 조직 인스턴스 (Organization Instance)
	- AWS Organizations 와 연동하여 모든 계정의 권한을 중앙에서 관리하는 권장 배포 방식이다.
- 웹 포털
	- 사용자는 복잡한 콘솔 주소 대신, 사용자 친화적인 웹 포털을 통해 할당된 리소스에 쉽게 접근한다.

3. Getting Start with Idnetity Center

IAM Center 검색 -> Enabole IAM Identity Center 의 'Enable' 클릭 $\to$ 'Enable'
AWS Organization 검색 $\to$ Integrated Service 를 'Access and permissions' 로 지정. $\to$ AWS IAM Identity Center (AWS Single Sign-On) 클릭 $\to$ Change to 'Enable Trusted Access'

![AWS_Organiation](/Image/Server/AWS_Organizations.png)

![[IAM_Identity_Center_Setup.png]]

- IAM User 추가 : IAM Identity Center $\to$  Add User $\to$ Input to Primary information $\to$ Click 'next' $\to$ Primary Information 에 입력된 email 로 발송된 인증 메일을 수행.
![AWS_UserList_In_IAM_Identity_Center](AWS_UserList_In_IAM_Identity_Center.png)

4. Permission Set
	- Create Permission Set
		1. IAM Identity Center 의 사이드 패널에서 'Permission Sets' 선택
		2. 'Create Permission set' 클릭
		3. Permission Set Type 에서 Types 를 Predefined permission set 로 설정
		4. Policy for predefine permission set 에서 AdministratorAccess 를 선택.
		5. Specify permission Set details 를 설정.
![AWS_Permission_Sets_List](Image/Server/AWS_Permission_Sets_List.png)

여기에서 ARM 은 Amazon Resource Name 의 약자로 AWS 리소스를 참조하는 데 사용되는 고유 식별자이다. Permission Set 과 같은 새로운 리소스를 AWS 에 생성할 때마다 해당 리소스를 식별하기 위한 ARM 이 부여된다. 이를 통해 AWS 서비스와 애플리케이션이서로를 정확히 식별하고 상호 작용할 수 있게 해준다.
'Provision Status' 는 해당 Permission Set 가 대상 AWS 계정에 성공적으로 적용되었는지를 나타낸다. permission Set 이 provision 되었다는 것은 필요한 IAM 역할과 정책이 생성되어 지정된 계정에 할당되었다는 뜻이다.

- .
	- Set up permission to Account
		1. IAM Identity Center 의 사이드 패널에서 'Permission Sets' 선택
		2. 'Assign users or groups' 클릭
		3. 'Select users and groups' 에서 Users 의 User 하나를 선택한다. $\to$ 'Next' 클릭
		4. 'Permission Sets' 에서 'Permission Set' 하나를 선택. $\to$ 'Next' 클릭
		5. 'Review and Submit' 에서 'Submit' 클릭
		6. ![AWS_Accounts 확인](AWS_Accounts_Organizational_structure.png)
		7. IAM Identity Center 의 side pannel 에서 Users 선택 $\to$  Usernames 하나 선택 $\to$ 해당 User 의 정보를 확인할 수 있다.
	- Identity Center User 를 이용해 콘솔에 접속
		1. IAM Identity Center 의 side pannel 에서 Settings 선택 $\to$ Identity Source 의 'AES access portal URL' 선택 $\to$ 이 URL이 Identidy Center 사용자 계정으로 로그인하기 위해 가야할 주소이다. $\to$  따라서 해당 URL 를 간직해 뒀다가 Identity Center 사용자로 로그인할 때 사용한다.
		2. ![AWS Access Portal](/Image/Server/AWS_Access_Portal.png)
			1. 계정 번호를 클릭하면 권한과 엑세스 키를 볼 수 있다. 
			2. Command Line 에서든, 코드를 통해서든, AWS API 를 호출하려면 엑세스 키가 필요하다.
			3. IAM 계정으로는 Bills 서버스에 접속할 수 없다. ![AWS_Rejecting_Access_to_Bills_Pannel](/Image/Server/AWS_Rejecting_Access_to_Bills_Pannel.png)